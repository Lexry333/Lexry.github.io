<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>作品集 | Portfolio</title>
    <style>
        /* 基础重置 & 性能优化 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-drag: none;
            -webkit-tap-highlight-color: transparent;
            tap-highlight-color: transparent;
        }

        /* 高端动态背景 - 粒子渐变+景深效果 */
        body {
            background: radial-gradient(circle at 50% 50%, #121826, #050811);
            min-height: 100vh;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            overflow-x: hidden;
            color: #fff;
            position: relative;
            /* 粒子背景画布 */
            canvas {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                z-index: 0;
                pointer-events: none;
                opacity: 0.7;
            }
        }

        /* 顶部标题栏 - 简约高端 */
        .header {
            position: relative;
            z-index: 10;
            text-align: center;
            padding: 2rem 1rem;
            margin-bottom: 1rem;
            h1 {
                font-size: 2.2rem;
                font-weight: 700;
                background: linear-gradient(120deg, #4facfe, #00f2fe);
                -webkit-background-clip: text;
                background-clip: text;
                color: transparent;
                margin-bottom: 0.5rem;
            }
            .subtitle {
                color: #a0aec0;
                font-size: 0.95rem;
                letter-spacing: 0.5px;
                line-height: 1.5;
            }
            .subtitle-en {
                color: #718096;
                font-size: 0.85rem;
                letter-spacing: 0.3px;
                margin-top: 0.2rem;
            }
        }

        /* 核心：沉浸式网格画廊（替代滚轮列表） */
        .gallery-container {
            position: relative;
            z-index: 10;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem 3rem;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            /* 网格项悬停动画 */
            .gallery-item {
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
                transform: translateY(0);
                transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                cursor: pointer;
                position: relative;
                /* 移动端点击反馈 */
                -webkit-tap-highlight-color: rgba(79, 172, 254, 0.1);
                /* 防盗水印层 */
                &::after {
                    content: "";
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+5bm/5pyN5Lq6PC90aXRsZT48dGV4dCB4PSIzMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiNmZmYvMzAwIj7nlLXorr7orr7mlL/nlYw8L3RleHQ+PC9zdmc+") repeat;
                    background-size: 120px;
                    opacity: 0.12;
                    pointer-events: none;
                    z-index: 1;
                }
                /* 悬停/点击效果 */
                &:hover, &:active {
                    transform: translateY(-8px) scale(1.02);
                    box-shadow: 0 16px 48px rgba(0, 191, 255, 0.2);
                }
                /* 图片容器 */
                .gallery-img-wrapper {
                    width: 100%;
                    height: 220px;
                    overflow: hidden;
                    position: relative;
                    /* 加载动画 */
                    &.loading::before {
                        content: "";
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        width: 40px;
                        height: 40px;
                        margin: -20px 0 0 -20px;
                        border: 3px solid rgba(79, 172, 254, 0.3);
                        border-radius: 50%;
                        border-top-color: #4facfe;
                        animation: spin 1s linear infinite;
                        z-index: 2;
                    }
                    /* 图片样式 */
                    img {
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                        transform-origin: center;
                        transition: transform 0.3s ease;
                        /* 防盗模糊（加载完成后清除） */
                        filter: blur(2px);
                        &.loaded {
                            filter: none;
                        }
                    }
                }
                /* 作品标题 */
                .item-title {
                    padding: 1rem;
                    font-size: 1rem;
                    font-weight: 500;
                    color: #e2e8f0;
                    background: linear-gradient(to bottom, transparent, rgba(17, 24, 39, 0.8));
                }
            }
        }

        /* 全屏预览模式（保留拖拽缩放） */
        .preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 8, 17, 0.98);
            z-index: 1000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem 1rem;
            /* 预览图片容器 */
            .preview-img-container {
                width: 90%;
                max-width: 1200px;
                height: 80vh;
                overflow: hidden;
                position: relative;
                margin-bottom: 1rem;
                /* 预览图片 */
                img {
                    width: 100%;
                    height: 100%;
                    object-fit: contain;
                    cursor: grab;
                    transform-origin: center;
                    transition: transform 0.05s linear;
                    &:active {
                        cursor: grabbing;
                    }
                }
            }
            /* 导航控制栏 */
            .preview-controls {
                display: flex;
                align-items: center;
                justify-content: space-between;
                width: 90%;
                max-width: 1200px;
                margin-top: 1rem;
                /* 翻页按钮 */
                .nav-btn {
                    width: 48px;
                    height: 48px;
                    border-radius: 50%;
                    background: rgba(79, 172, 254, 0.2);
                    color: #fff;
                    border: 1px solid rgba(79, 172, 254, 0.4);
                    font-size: 1.2rem;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    &:hover {
                        background: rgba(79, 172, 254, 0.4);
                        transform: scale(1.05);
                    }
                    &:disabled {
                        opacity: 0.2;
                        cursor: not-allowed;
                        transform: none;
                    }
                }
                /* 页码指示器 */
                .page-indicator {
                    color: #a0aec0;
                    font-size: 0.9rem;
                    span {
                        color: #4facfe;
                        font-weight: 600;
                    }
                }
                /* 关闭按钮 */
                .close-btn {
                    width: 48px;
                    height: 48px;
                    border-radius: 50%;
                    background: rgba(248, 113, 113, 0.2);
                    color: #fff;
                    border: 1px solid rgba(248, 113, 113, 0.4);
                    font-size: 1.2rem;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    &:hover {
                        background: rgba(248, 113, 113, 0.4);
                        transform: scale(1.05);
                    }
                }
            }
            /* 预览提示语 */
            .preview-tip {
                position: absolute;
                top: 2rem;
                color: #a0aec0;
                font-size: 0.9rem;
                background: rgba(17, 24, 39, 0.7);
                padding: 0.5rem 1rem;
                border-radius: 20px;
                pointer-events: none;
                line-height: 1.5;
            }
            .preview-tip-en {
                font-size: 0.8rem;
                color: #90a0b7;
                margin-top: 0.2rem;
            }
        }

        /* 动画定义 */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* 响应式适配 - 重点优化移动端 */
        @media (max-width: 768px) {
            /* 基础优化：减少动画复杂度 */
            * {
                transition-duration: 0.2s !important; /* 缩短过渡时间，减少卡顿 */
                animation-duration: 0.8s !important; /* 加快加载动画 */
            }

            .header h1 {
                font-size: 1.8rem;
            }
            .gallery-container {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
                gap: 1rem;
                /* 移动端画廊项优化 */
                .gallery-item {
                    /* 简化阴影，提升性能 */
                    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
                    &:hover, &:active {
                        box-shadow: 0 8px 24px rgba(0, 191, 255, 0.15);
                        transform: translateY(-4px) scale(1.01); /* 减小位移和缩放，降低计算量 */
                    }
                    .gallery-img-wrapper {
                        height: 180px;
                        /* 简化加载动画 */
                        &.loading::before {
                            width: 30px;
                            height: 30px;
                            border-width: 2px;
                        }
                    }
                    /* 增大点击区域，解决点不开问题 */
                    .item-title {
                        padding: 1.2rem 1rem;
                    }
                }
            }
            /* 移动端预览模式优化 - 修复尺寸问题 */
            .preview-modal {
                padding: 0; /* 移除内边距，最大化可用空间 */
                display: flex;
                align-items: center;
                justify-content: center;
                /* 提示语适配 */
                .preview-tip {
                    top: 1rem;
                    left: 50%;
                    transform: translateX(-50%);
                    font-size: 0.8rem;
                    padding: 0.4rem 0.8rem;
                    z-index: 1001;
                }
                .preview-img-container {
                    width: 100%; /* 全屏宽度 */
                    height: calc(100vh - 80px); /* 自适应高度，预留控制栏空间 */
                    max-width: 100%; /* 取消最大宽度限制 */
                    /* 移动端预览图片优化 - 强制正确适配 */
                    img {
                        transition: transform 0.03s linear !important; /* 更快的过渡，减少卡顿 */
                        touch-action: none; /* 禁用浏览器默认触摸行为，解决冲突 */
                        max-width: none !important;
                        max-height: none !important;
                        width: auto !important;
                        height: auto !important;
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%) !important;
                    }
                }
                .preview-controls {
                    width: 100%;
                    height: 80px;
                    margin: 0;
                    padding: 0 1rem;
                    position: fixed;
                    bottom: 0;
                    left: 0;
                    background: rgba(0, 8, 17, 0.8);
                    /* 增大移动端按钮，提升点击体验 */
                    .nav-btn, .close-btn {
                        width: 44px;
                        height: 44px;
                        font-size: 1.1rem;
                        /* 增加内边距，扩大点击区域 */
                        padding: 0;
                    }
                    .page-indicator {
                        font-size: 0.85rem;
                    }
                }
            }
            /* 移动端粒子画布透明度降低，减少渲染压力 */
            canvas {
                opacity: 0.5 !important;
            }
        }

        /* 强制隐藏右键菜单（防盗） */
        [oncontextmenu] {
            pointer-events: auto !important;
        }
    </style>
    <!-- 预加载字体提升性能 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>

<!-- 全维度防盗：禁用右键+选择+拖拽+复制 -->
<body oncontextmenu="return false" onselectstart="return false" ondragstart="return false" oncopy="return false" oncut="return false" onpaste="return false">
    <!-- 粒子背景画布（高端视觉） -->
    <canvas id="particleCanvas"></canvas>

    <!-- 顶部标题栏 -->
    <div class="header">
        <h1>作品集</h1>
        <p class="subtitle">点击图片查看 | 滚轮缩放 | 拖拽移动
            <span class="subtitle-en">Click to view | Scroll to zoom | Drag to move</span>
        </p>
    </div>

    <!-- 核心：沉浸式网格画廊（替代滚轮列表） -->
    <div class="gallery-container" id="galleryContainer">
        <!-- 画廊项由JS动态生成（性能优化） -->
    </div>

    <!-- 全屏预览模态框 -->
    <div class="preview-modal" id="previewModal">
        <div class="preview-tip">←→ 切换 | ESC 关闭 | 滚轮缩放 | 拖拽移动
            <div class="preview-tip-en">←→ Switch | ESC Close | Scroll to zoom | Drag to move</div>
        </div>
        <div class="preview-img-container" id="previewImgContainer">
            <img src="" id="previewImg" alt="作品" class="portfolio-img">
        </div>
        <div class="preview-controls">
            <button class="nav-btn prev-btn" id="prevBtn">←</button>
            <div class="page-indicator">作品 <span id="currentPageNum">1</span> / <span id="totalPageNum">7</span></div>
            <button class="nav-btn next-btn" id="nextBtn">→</button>
            <button class="close-btn" id="closeBtn">×</button>
        </div>
    </div>

    <script>
        // ====================== 性能优化：提前声明常量 ======================
        const imgList = [
            { src: "111.jpg", title: "1" },
            { src: "2025-1.jpg", title: "2" },
            { src: "2025.jpg", title: "3" },
            { src: "4.jpg", title: "4" },
            { src: "3.jpg", title: "5" },
            { src: "2.jpg", title: "6" },
            { src: "1.jpg", title: "7" }
        ]; // 作品数据（纯数字序号）
        let currentIndex = 0; // 当前预览索引
        const imgStates = {}; // 保存每张图片的缩放/位移状态
        // 检测是否为移动端（仅用于移动端优化）
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        // 新增：移动端点击防抖变量
        let touchClickTimer = null;
        let isScrolling = false;
        
        // 初始化图片状态（性能优化：提前初始化）
        imgList.forEach((_, index) => {
            imgStates[index] = { scale: 1, x: 0, y: 0 };
        });

        // ====================== DOM元素获取（性能优化：只获取一次） ======================
        const galleryContainer = document.getElementById('galleryContainer');
        const previewModal = document.getElementById('previewModal');
        const previewImg = document.getElementById('previewImg');
        const previewImgContainer = document.getElementById('previewImgContainer');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const closeBtn = document.getElementById('closeBtn');
        const currentPageNum = document.getElementById('currentPageNum');
        const totalPageNum = document.getElementById('totalPageNum');
        const particleCanvas = document.getElementById('particleCanvas');
        const ctx = particleCanvas.getContext('2d');

        // ====================== 高端视觉：粒子背景（移动端轻量化） ======================
        function initParticleBackground() {
            // 设置画布尺寸（响应式）
            function resizeCanvas() {
                particleCanvas.width = window.innerWidth;
                particleCanvas.height = window.innerHeight;
            }
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            // 粒子类（轻量级，移动端进一步简化）
            class Particle {
                constructor() {
                    this.x = Math.random() * particleCanvas.width;
                    this.y = Math.random() * particleCanvas.height;
                    // 移动端减小粒子大小，降低渲染压力
                    this.size = isMobile ? (Math.random() * 0.8 + 0.2) : (Math.random() * 1.5 + 0.5);
                    // 移动端降低粒子速度，减少计算
                    this.speedX = isMobile ? (Math.random() * 0.2 - 0.1) : (Math.random() * 0.5 - 0.25);
                    this.speedY = isMobile ? (Math.random() * 0.2 - 0.1) : (Math.random() * 0.5 - 0.25);
                    this.color = 'rgba(79, 172, 254, 0.6)';
                }
                update() {
                    this.x += this.speedX;
                    this.y += this.speedY;
                    // 边界回弹
                    if (this.x < 0 || this.x > particleCanvas.width) this.speedX = -this.speedX;
                    if (this.y < 0 || this.y > particleCanvas.height) this.speedY = -this.speedY;
                }
                draw() {
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            // 创建粒子（移动端大幅减少数量，避免卡顿）
            const baseCount = Math.floor(window.innerWidth / 10);
            const particleCount = isMobile ? Math.min(baseCount, 50) : Math.min(baseCount, 150);
            const particles = Array.from({ length: particleCount }, () => new Particle());

            // 动画循环（移动端降低帧率，减少性能消耗）
            let lastFrameTime = 0;
            const frameInterval = isMobile ? 30 : 16; // 移动端约30fps，桌面端60fps
            function animate(timestamp) {
                if (timestamp - lastFrameTime < frameInterval) {
                    requestAnimationFrame(animate);
                    return;
                }
                lastFrameTime = timestamp;
                
                ctx.clearRect(0, 0, particleCanvas.width, particleCanvas.height);
                particles.forEach(particle => {
                    particle.update();
                    particle.draw();
                });
                requestAnimationFrame(animate);
            }
            animate(0);
        }

        // ====================== 核心：动态生成网格画廊（移动端优化加载） ======================
        function renderGallery() {
            // 清空容器（避免重复）
            galleryContainer.innerHTML = '';
            
            // 批量生成画廊项（文档碎片：减少DOM重绘）
            const fragment = document.createDocumentFragment();
            
            imgList.forEach((item, index) => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item';
                galleryItem.dataset.index = index;
                
                // 图片容器（带加载状态）
                const imgWrapper = document.createElement('div');
                imgWrapper.className = 'gallery-img-wrapper loading';
                
                // 图片元素（移动端加载优化）
                const img = document.createElement('img');
                // 移动端使用低分辨率占位图+渐进式加载
                if (isMobile) {
                    // 先加载小尺寸占位图（提升加载速度）
                    img.src = item.src;
                    // 预加载高清图到缓存
                    const highResImg = new Image();
                    highResImg.src = item.src;
                    highResImg.onload = function() {
                        img.src = this.src;
                    };
                } else {
                    img.src = item.src;
                }
                img.alt = `作品${item.title}`;
                // 移动端强制懒加载，且降低图片解码优先级
                img.loading = isMobile ? 'eager' : 'lazy'; // 移动端改为立即加载，避免延迟
                img.decoding = isMobile ? 'async' : 'auto';
                img.dataset.index = index;
                // 移动端图片预加载提示
                img.setAttribute('fetchpriority', isMobile ? 'high' : 'auto');
                
                // 图片加载完成（清除模糊+加载动画）
                img.onload = function() {
                    imgWrapper.classList.remove('loading');
                    img.classList.add('loaded');
                    // 防盗：禁止图片保存（多层防护）
                    this.oncontextmenu = () => false;
                    this.oncopy = () => false;
                };
                
                // 图片加载失败（占位图）
                img.onerror = function() {
                    imgWrapper.classList.remove('loading');
                    this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iIzIyMiIvPjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTYiIGZpbGw9IiNmZmYiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIyIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7nlLXorr7orr7mlL/nlYw8L3RleHQ+PC9zdmc+';
                };
                
                // 作品标题（纯数字）
                const title = document.createElement('div');
                title.className = 'item-title';
                title.textContent = item.title;
                
                // 组装DOM
                imgWrapper.appendChild(img);
                galleryItem.appendChild(imgWrapper);
                galleryItem.appendChild(title);
                fragment.appendChild(galleryItem);
                
                // 绑定点击事件（移动端修复点不开问题 + 防误触）
                galleryItem.addEventListener('click', () => {
                    // 移动端防误触：滚动时不触发点击
                    if (isMobile && isScrolling) return;
                    currentIndex = index;
                    openPreview();
                });
                // 移动端额外绑定touch事件，解决点击穿透/无响应 + 防误触
                if (isMobile) {
                    galleryItem.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        // 重置滚动状态
                        isScrolling = false;
                        // 防抖：长按/滑动时不触发点击
                        touchClickTimer = setTimeout(() => {
                            currentIndex = index;
                            openPreview();
                        }, 200); // 200ms防抖，滑动时会被清除
                    }, { passive: false });
                    
                    // 触摸移动时清除定时器，防止误触
                    galleryItem.addEventListener('touchmove', (e) => {
                        clearTimeout(touchClickTimer);
                        isScrolling = true;
                    }, { passive: true });
                    
                    // 触摸结束时清除定时器
                    galleryItem.addEventListener('touchend', () => {
                        clearTimeout(touchClickTimer);
                        // 延迟重置滚动状态，避免快速点击被判定为滚动
                        setTimeout(() => {
                            isScrolling = false;
                        }, 100);
                    }, { passive: true });
                }
                
                // 提前绑定画廊图片的拖拽缩放（保留功能，移动端简化）
                bindImgEvents(img, false, index);
            });
            
            // 一次性插入DOM（性能优化）
            galleryContainer.appendChild(fragment);
            
            // 设置总页码
            totalPageNum.textContent = imgList.length;
        }

        // ====================== 预览模式控制（修复移动端尺寸+加载） ======================
        // 打开预览
        function openPreview() {
            // 移动端预加载当前图片
            if (isMobile) {
                const img = new Image();
                img.src = imgList[currentIndex].src;
                img.onload = function() {
                    previewImg.src = this.src;
                    // 修复移动端图片居中
                    fixMobileImagePosition();
                };
            } else {
                previewImg.src = imgList[currentIndex].src;
            }
            
            previewImg.alt = `作品${imgList[currentIndex].title}`;
            
            // 恢复图片状态
            resetPreviewImgTransform();
            
            // 更新页码
            currentPageNum.textContent = currentIndex + 1;
            
            // 更新按钮状态
            updateNavBtnStates();
            
            // 显示预览，隐藏滚动
            previewModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // 绑定预览图片的拖拽缩放（移动端简化逻辑）
            bindImgEvents(previewImg, true);
            
            // 防盗：预览图额外防护
            previewImg.oncontextmenu = () => false;
            previewImg.oncopy = () => false;
            
            // 移动端强制重绘，修复尺寸
            if (isMobile) {
                setTimeout(fixMobileImagePosition, 50);
            }
        }

        // 修复移动端预览图片位置
        function fixMobileImagePosition() {
            if (!isMobile || !previewImg) return;
            
            const container = previewImgContainer;
            const img = previewImg;
            
            // 重置基础样式（关键：移除最大宽高限制）
            img.style.position = 'absolute';
            img.style.top = '50%';
            img.style.left = '50%';
            img.style.maxWidth = 'none';
            img.style.maxHeight = 'none';
            img.style.width = 'auto';
            img.style.height = 'auto';
            
            // 等待图片加载完成后调整
            if (img.complete) {
                adjustMobileImage();
            } else {
                img.onload = adjustMobileImage;
            }
        }

        // 调整移动端图片尺寸和位置
        function adjustMobileImage() {
            const container = previewImgContainer;
            const img = previewImg;
            
            const containerWidth = container.offsetWidth;
            const containerHeight = container.offsetHeight;
            const imgWidth = img.naturalWidth;
            const imgHeight = img.naturalHeight;
            
            // 计算初始缩放比例（仅初始化时使用，后续可自由缩放拖动）
            const scaleX = containerWidth / imgWidth;
            const scaleY = containerHeight / imgHeight;
            const initScale = Math.min(scaleX, scaleY, 1); // 不放大，只缩小
            
            // 只有首次加载时设置初始缩放，后续保留用户调整的状态
            if (imgStates[currentIndex].scale === 1) {
                imgStates[currentIndex].scale = initScale;
                imgStates[currentIndex].x = 0;
                imgStates[currentIndex].y = 0;
            }
            
            // 应用变换
            updateImgTransform(img, imgStates[currentIndex]);
        }

        // 关闭预览
        function closePreview() {
            // 保存当前图片状态
            savePreviewImgState();
            
            // 隐藏预览，恢复滚动
            previewModal.style.display = 'none';
            document.body.style.overflow = '';
        }

        // 切换作品
        function switchItem(direction) {
            // 保存当前状态
            savePreviewImgState();
            
            // 更新索引
            currentIndex += direction;
            
            // 边界处理
            currentIndex = Math.max(0, Math.min(imgList.length - 1, currentIndex));
            
            // 移动端预加载下一张图片
            if (isMobile) {
                const img = new Image();
                img.src = imgList[currentIndex].src;
                img.onload = function() {
                    previewImg.src = this.src;
                    fixMobileImagePosition();
                };
            } else {
                previewImg.src = imgList[currentIndex].src;
            }
            
            previewImg.alt = `作品${imgList[currentIndex].title}`;
            
            // 恢复新作品状态
            resetPreviewImgTransform();
            
            // 移动端修复位置
            if (isMobile) {
                setTimeout(fixMobileImagePosition, 50);
            }
            
            // 更新页码和按钮
            currentPageNum.textContent = currentIndex + 1;
            updateNavBtnStates();
        }

        // 更新导航按钮状态
        function updateNavBtnStates() {
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === imgList.length - 1;
        }

        // ====================== 核心：保留拖拽缩放功能（移动端大幅优化） ======================
        // 绑定图片事件（区分画廊/预览，移动端简化逻辑）
        function bindImgEvents(img, isPreview = false, galleryIndex = null) {
            // 移除原有事件（避免重复绑定，性能优化）
            img.removeEventListener('wheel', handleWheel);
            img.removeEventListener('mousedown', handleMouseDown);
            img.removeEventListener('touchstart', handleTouchStart);
            
            // 滚轮缩放（PC端优化：移除节流，提升响应速度）
            function handleWheel(e) {
                if (isMobile) return; // 移动端直接返回，禁用滚轮缩放
                e.preventDefault();
                
                const index = isPreview ? currentIndex : galleryIndex;
                const state = imgStates[index];
                
                // 优化缩放步长和响应速度，移除节流定时器
                const scaleDelta = e.deltaY < 0 ? 0.1 : -0.1; // 减小步长，更细腻
                state.scale = Math.max(0.5, Math.min(6, state.scale + scaleDelta));
                
                // 立即更新变换，无延迟
                updateImgTransform(img, state);
            }
            if (!isMobile) { // 仅桌面端绑定滚轮事件
                img.addEventListener('wheel', handleWheel, { passive: false });
            }
            
            // 鼠标拖拽（仅桌面端）
            function handleMouseDown(e) {
                if (isMobile) return; // 移动端直接返回
                e.preventDefault();
                const index = isPreview ? currentIndex : galleryIndex;
                const state = imgStates[index];
                
                let startX = e.clientX - state.x;
                let startY = e.clientY - state.y;
                let isDragging = false;
                
                img.style.cursor = 'grabbing';
                
                // 鼠标移动（性能优化：使用passive）
                function handleMouseMove(e) {
                    if (!isDragging) return;
                    state.x = e.clientX - startX;
                    state.y = e.clientY - startY;
                    updateImgTransform(img, state);
                }
                
                // 鼠标抬起
                function handleMouseUp() {
                    isDragging = false;
                    img.style.cursor = 'grab';
                    document.removeEventListener('mousemove', handleMouseMove);
                    document.removeEventListener('mouseup', handleMouseUp);
                }
                
                isDragging = true;
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
            }
            if (!isMobile) { // 仅桌面端绑定鼠标事件
                img.addEventListener('mousedown', handleMouseDown);
            }
            
            // 移动端触摸（大幅优化，解决卡顿/冲突 + 修复拖动问题）
            function handleTouchStart(e) {
                if (!isMobile) return; // 仅移动端处理触摸事件
                e.preventDefault();
                const index = isPreview ? currentIndex : galleryIndex;
                const state = imgStates[index];
                const touches = e.touches;
                
                let touchStart = {};
                let lastScale = state.scale;
                let lastX = state.x;
                let lastY = state.y;
                let touchTimer = null;
                
                // 记录初始触摸位置
                touchStart.startX = touches[0].clientX;
                touchStart.startY = touches[0].clientY;
                touchStart.startTime = Date.now();
                
                // 单指拖拽（移动端修复拖动逻辑）
                if (touches.length === 1) {
                    touchStart.x = touches[0].clientX - state.x;
                    touchStart.y = touches[0].clientY - state.y;
                    // 防抖：避免快速触摸导致的卡顿（缩短到30ms）
                    touchTimer = setTimeout(() => {
                        touchStart.isDragging = true;
                    }, 30);
                }
                // 双指缩放（移动端简化计算）
                else if (touches.length === 2) {
                    touchStart.scale = state.scale;
                    touchStart.distance = getTouchDistance(touches[0], touches[1]);
                    clearTimeout(touchTimer); // 取消拖拽判定
                }
                
                // 触摸移动（移动端修复，支持自由拖动）
                function handleTouchMove(e) {
                    if (!isMobile) return;
                    e.preventDefault();
                    const touches = e.touches;
                    
                    // 移除节流，让拖动更流畅
                    if (touches.length === 1 && touchStart.isDragging) {
                        // 单指拖拽：直接更新位置，无限制
                        state.x = touches[0].clientX - touchStart.x;
                        state.y = touches[0].clientY - touchStart.y;
                        updateImgTransform(img, state);
                    }
                    else if (touches.length === 2) {
                        // 双指缩放：简化距离计算，限制缩放范围
                        const distance = getTouchDistance(touches[0], touches[1]);
                        const newScale = Math.max(0.5, Math.min(8, touchStart.scale * (distance / touchStart.distance)));
                        state.scale = newScale;
                        updateImgTransform(img, state);
                    }
                }
                
                // 触摸结束（清理定时器，避免内存泄漏）
                function handleTouchEnd() {
                    if (!isMobile) return;
                    clearTimeout(touchTimer);
                    img.removeEventListener('touchmove', handleTouchMove);
                    document.removeEventListener('touchend', handleTouchEnd);
                    document.removeEventListener('touchcancel', handleTouchEnd);
                }
                
                img.addEventListener('touchmove', handleTouchMove, { passive: false });
                document.addEventListener('touchend', handleTouchEnd);
                document.addEventListener('touchcancel', handleTouchEnd);
            }
            // 仅移动端绑定触摸事件
            if (isMobile) {
                img.addEventListener('touchstart', handleTouchStart, { passive: false });
            }
        }

        // 计算双指距离（移动端简化计算）
        function getTouchDistance(t1, t2) {
            if (!isMobile) {
                const dx = t2.clientX - t1.clientX;
                const dy = t2.clientY - t1.clientY;
                return Math.sqrt(dx * dx + dy * dy) || 1;
            } else {
                // 移动端简化距离计算，减少平方根运算
                const dx = Math.abs(t2.clientX - t1.clientX);
                const dy = Math.abs(t2.clientY - t1.clientY);
                return (dx + dy) / 2 || 1;
            }
        }

        // 更新图片变换（移动端修复尺寸 + 支持自由拖动）
        function updateImgTransform(img, state) {
            if (!img || !state) return;
            // 移动端使用3D变换，开启硬件加速，支持自由拖动
            if (isMobile) {
                // 结合居中+缩放+位移（移除位置限制）
                const translateX = state.x || 0;
                const translateY = state.y || 0;
                img.style.transform = `translate3d(calc(-50% + ${translateX}px), calc(-50% + ${translateY}px), 0) scale(${state.scale})`;
                img.style.transformOrigin = 'center center';
            } else {
                img.style.transform = `translate(${state.x}px, ${state.y}px) scale(${state.scale})`;
            }
        }

        // 保存预览图片状态（移动端简化逻辑）
        function savePreviewImgState() {
            if (!previewImg.style.transform) return;
            
            const transform = previewImg.style.transform;
            const scaleMatch = transform.match(/scale\(([\d.]+)\)/);
            const xMatch = transform.match(/translate(3d)?\(calc\(-50% \+ ([\d.-]+)px\),/);
            const yMatch = transform.match(/calc\(-50% \+ ([\d.-]+)px\)(, 0)?\)/);
            
            if (scaleMatch && xMatch && yMatch) {
                imgStates[currentIndex].scale = parseFloat(scaleMatch[1]);
                imgStates[currentIndex].x = parseFloat(xMatch[2]);
                imgStates[currentIndex].y = parseFloat(yMatch[1]);
            } else if (scaleMatch && transform.match(/translate\(([\d.-]+)px,/)) {
                // 兼容桌面端
                const xMatchDesktop = transform.match(/translate\(([\d.-]+)px,/);
                const yMatchDesktop = transform.match(/, ([\d.-]+)px\)/);
                imgStates[currentIndex].scale = parseFloat(scaleMatch[1]);
                imgStates[currentIndex].x = parseFloat(xMatchDesktop[1]);
                imgStates[currentIndex].y = parseFloat(yMatchDesktop[1]);
            }
        }

        // 重置预览图片变换
        function resetPreviewImgTransform() {
            updateImgTransform(previewImg, imgStates[currentIndex]);
        }

        // ====================== 全维度防盗加固（移动端不改动） ======================
        function initSecurity() {
            // 1. 禁用所有快捷键（F12/Ctrl+U/Ctrl+S等）
            document.addEventListener('keydown', (e) => {
                // 禁用F12、Ctrl+U、Ctrl+S、Ctrl+Shift+I、Alt+F4等
                const forbiddenKeys = ['F12', 'u', 's', 'I'];
                if (e.key === 'F12' || 
                    (e.ctrlKey && forbiddenKeys.includes(e.key)) || 
                    (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                    (e.altKey && e.key === 'F4')) {
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
            }, true); // 捕获阶段触发，优先级最高

            // 2. 禁用控制台注入（防调试）
            try {
                (function() {
                    const _constructor = constructor;
                    constructor = function() {
                        if (arguments && typeof arguments[0] === 'string' && arguments[0].indexOf('debugger') !== -1) {
                            return;
                        }
                        return _constructor.apply(this, arguments);
                    };
                    constructor.prototype = _constructor.prototype;
                })();
            } catch (e) {}

            // 3. 图片canvas重绘（防直接下载，核心防盗）
            function protectImages() {
                const images = document.querySelectorAll('img');
                images.forEach(img => {
                    // 等待图片加载完成
                    img.onload = function() {
                        // 创建canvas重绘（图片内容转为canvas，无法直接下载）
                        if (this.classList.contains('loaded') && !this.dataset.protected) {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            canvas.width = this.naturalWidth;
                            canvas.height = this.naturalHeight;
                            
                            // 绘制图片+隐形水印（防盗）
                            ctx.drawImage(this, 0, 0);
                            // 隐形水印（肉眼不可见，防篡改）
                            ctx.fillStyle = 'rgba(0,0,0,0.005)';
                            ctx.font = '1px Arial';
                            ctx.fillText('PROTECTED BY AUTHOR ' + Date.now(), 0, 1);
                            
                            // 替换图片为canvas（保留原属性）
                            const parent = this.parentElement;
                            const canvasCopy = canvas.cloneNode(true);
                            canvasCopy.className = this.className;
                            canvasCopy.dataset.index = this.dataset.index;
                            canvasCopy.style.width = '100%';
                            canvasCopy.style.height = '100%';
                            canvasCopy.style.objectFit = 'cover';
                            canvasCopy.oncontextmenu = () => false;
                            
                            // 替换DOM（保留事件）
                            parent.replaceChild(canvasCopy, this);
                            
                            // 重新绑定事件
                            const index = parseInt(canvasCopy.dataset.index);
                            bindImgEvents(canvasCopy, false, index);
                            
                            // 标记已保护
                            canvasCopy.dataset.protected = 'true';
                        }
                    };
                });
            }

            // 4. 定时检查DOM（防删除防盗代码）
            setInterval(() => {
                protectImages();
                // 重新绑定所有防盗事件
                document.body.oncontextmenu = () => false;
                document.body.onselectstart = () => false;
            }, 1000);
        }

        // ====================== 事件绑定（移动端优化） ======================
        function bindEvents() {
            // 预览导航按钮
            prevBtn.addEventListener('click', () => switchItem(-1));
            nextBtn.addEventListener('click', () => switchItem(1));
            closeBtn.addEventListener('click', closePreview);

            // 移动端按钮额外绑定touch事件，解决点击无响应
            if (isMobile) {
                prevBtn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    switchItem(-1);
                }, { passive: false });
                nextBtn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    switchItem(1);
                }, { passive: false });
                closeBtn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    closePreview();
                }, { passive: false });
            }

            // 键盘控制（预览模式）
            document.addEventListener('keydown', (e) => {
                if (previewModal.style.display === 'flex') {
                    switch(e.key) {
                        case 'ArrowLeft': switchItem(-1); break;
                        case 'ArrowRight': switchItem(1); break;
                        case 'Escape': closePreview(); break;
                        default: break;
                    }
                }
            });

            // 点击模态框空白处关闭（体验优化）
            previewModal.addEventListener('click', (e) => {
                if (e.target === previewModal) closePreview();
            });
            // 移动端模态框空白处touch事件
            if (isMobile) {
                previewModal.addEventListener('touchstart', (e) => {
                    if (e.target === previewModal) closePreview();
                }, { passive: false });
            }
        }

        // ====================== 初始化（性能优化：异步加载） ======================
        window.addEventListener('DOMContentLoaded', () => {
            // 异步初始化，不阻塞页面渲染
            setTimeout(() => {
                initParticleBackground(); // 高端背景
                renderGallery(); // 生成画廊
                bindEvents(); // 绑定事件
                initSecurity(); // 防盗加固
                
                // 移动端预加载所有图片到缓存
                if (isMobile) {
                    imgList.forEach(item => {
                        const img = new Image();
                        img.src = item.src;
                        img.fetchpriority = 'low'; // 低优先级，不阻塞首屏
                    });
                }
            }, 0);
        });

        // ====================== 终极性能优化：预加载关键资源 ======================
        // 预加载前3张图片（提升首屏体验）
        function preloadCriticalImages() {
            const criticalImages = imgList.slice(0, 3);
            criticalImages.forEach(item => {
                const img = new Image();
                img.src = item.src;
                img.fetchpriority = 'high';
                img.onload = () => console.log(`预加载完成：作品${item.title}`);
            });
        }
        preloadCriticalImages();
    </script>
</body>
</html>
